    push: 
    branches: [ main ]
    jobs: 
        pipeline: 
        runs-on: ubuntu-latest 
        steps: 
        -name: 1. Recuperation du code 
        uses: actions/checkout@v4 
        -name: 2. Setup JDK 17 
        uses: actions/setup-java@v4 
        with: 
        java-version: '17'
        distribution: 'zulu'
        -name: 3. Analyse SonarQube 
        env:
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }} 
        run: |
          cd mon_jpestore 
          mvn sonar:sonar -Dsonar.host.url= -Dsonar.projectKey=TP-Sonarqube
     
        -name: 4. Build et Push Docker 
        run: | 
          cd mon_jpestore
          echo "${{ secrets.DOCKERHUB_TOKEN }}" |
          docker login -u "${{ secrets.DOCKERHUB_USERNAME }}" --password-stdin 
          docker build -t salam630/jpetstore-groupe-app:latest . 
          docker push salam630/jpetstore-groupe-app:latest
        -name: 5. Deploiement sur EC2 
        uses: appleboy/ssh-action@master
        with:
        host: 16.16.67.62
        username: ubuntu
        key: ${{ secrets.SSH_PRIVATE_KEY }} 
        script: |
            sudo docker pull salam630/jpetstore-groupe-app:latest
             sudo docker stop petshop || true 
             sudo docker rm petshop || true 
             sudo docker run -d --name petshop -p 80:8080 salam630/jpetstore-groupe-app:latest